<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pomodoro</title>
    <link rel="stylesheet" href="./styles.css">
</head>
<body>


    <div class="digitalClock">
        <div class="date">
            <span id="dayname">Day</span>
            <span>/</span>
            <span id="month">Month</span>
            <span>/</span>
            <span id="year">Year</span>
            <span id="datePipe">|</span>
            <span id="daynum">00</span>
        </div>
        <div class="time">
            <span id="hours">00</span>
            <span> : </span>
            <span id="minutes">00</span>
            <span> : </span>
            <span id="seconds">00</span>
            <span id="period">AM</span>
        </div>
    </div>

    <div class="mainContainer">
        <span class="info">
            <h2>Pomodoro</h2>
        </span>

        <div class="mainFunctionality">
            <div class="clockMode">
                <div class="pomodoro">Pomodoro</div>
                <div class="shortBreak">Short Break</div>
                <div class="longBreak">Long Break</div>
            </div>

            <div class="pomodoroClock">
                <span id="timerMinutes">00</span>
                <span id="spaceBetween"> : </span>
                <span id="timerSeconds">00</span>
            </div>

            <div class="controls">
                <div class="stop">Stop</div>
                <div class="start">Start</div>
                <div class="skip"> >>></div>
            </div>
        </div>
    </div>

    <script>

        const hours = document.getElementById('hours');
        const minutes = document.getElementById('minutes');
        const seconds = document.getElementById('seconds');
        const period = document.getElementById('period');

        const dayname = document.getElementById('dayname');
        const month = document.getElementById('month');
        const daynum = document.getElementById('daynum');
        const year = document.getElementById('year');

        const weekDays = [ "Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday" ];

        setInterval(function() {
            const dateTime = new Date();

            hours.innerText = dateTime.getHours() < 10 ? '0' + dateTime.getHours() : dateTime.getHours();
            minutes.innerText = dateTime.getMinutes() < 10 ? '0' + dateTime.getMinutes() : dateTime.getMinutes();
            seconds.innerText = dateTime.getSeconds() < 10 ? '0' + dateTime.getSeconds() : dateTime.getSeconds();
            dateTime.getHours > 12 ? period.innerText = 'PM' : period.innerText = 'AM';

            dayname.innerText = dateTime.getDate();
            month.innerText = Number(dateTime.getMonth()) + 1;
            daynum.innerText = weekDays[dateTime.getDay()];
            year.innerText = dateTime.getFullYear();
        }, 1000);

        let intervalId;
        let timerFinish = false;
        let timerMode = 1;
        const timerMinutes = document.getElementById('timerMinutes');
        const timerSeconds = document.getElementById('timerSeconds');

        const pomodoro = 1500;
        const shortBreak = 300;
        const longBreak = 900;

        let timerPeriod = 1500;
        
        const setTimer = () => {
            timerMinutes.innerText =  Math.floor(timerPeriod / 60) < 10 ? '0' + Math.floor(timerPeriod / 60) : Math.floor(timerPeriod / 60);
            timerSeconds.innerText = timerPeriod % 60 < 10 ? '0' + timerPeriod % 60 : timerPeriod % 60;
        }

        setTimer();

        const runTimer = () => {
            intervalId = setInterval(function() {
                timerPeriod -= 1;
                setTimer();
                if(timerPeriod == 0) {
                    timerFinish = true;
                    clearInterval(intervalId);
                    return;
                }
            }, 1000);
        }

        const skipTimer = () => {
            clearInterval(intervalId);
            if(timerMode === 1) {
                timerPeriod = shortBreak;
                timerMode = 2;
            } else if(timerMode === 2) {
                timerPeriod = longBreak;
                timerMode = 3;
            } else {
                timerPeriod = pomodoro;
                timerMode = 1;
            }
        }

        const pomodoroEl = document.querySelector('.pomodoro');
        const shortBreakEl = document.querySelector('.shortBreak');
        const longBreakEl = document.querySelector('.longBreak');
        const modes = [pomodoroEl, shortBreakEl, longBreakEl];

        modes.forEach((mode) => {
            mode.addEventListener("click", function (e) {
                if(e.target.classList.contains("pomodoro")) {
                    timerPeriod = pomodoro;
                    timerMode = 1;
                } else if (e.target.classList.contains("shortBreak")) {
                    timerPeriod = shortBreak;
                    timerMode = 2;
                } else if (e.target.classList.contains("longBreak")) {
                    timerPeriod = longBreak;
                    timerMode = 3;
                }
                setTimer();
            });
        });

        let currentControl = 1;
        const stop = document.querySelector('.stop');
        const start = document.querySelector('.start');
        const skip = document.querySelector('.skip');
        const controls = [stop, start, skip];

        controls.forEach((control) => {
            control.addEventListener("click", function (e) {
                if(e.target.classList.contains("stop")) {
                    if(currentControl != 1) {
                        clearInterval(intervalId);
                        currentControl = 1;
                    }
                } else if (e.target.classList.contains("start")) {
                    if(currentControl != 2) {
                        runTimer();
                        currentControl = 2;
                    }
                } else if (e.target.classList.contains("skip")) {
                    skipTimer();
                    currentControl = 1;
                }
                setTimer();
            });
        });

    </script>
</body>
</html>